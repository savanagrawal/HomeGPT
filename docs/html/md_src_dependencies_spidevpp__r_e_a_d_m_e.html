<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HomeGPT: spidevpp - C++ wrapper for spidev</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="HomeGPT.png"/></td>
  <td id="projectalign">
   <div id="projectname">HomeGPT<span id="projectnumber">&#160;v.1.0</span>
   </div>
   <div id="projectbrief">HomeGPT revolutionizes home automation with advanced features such as facial recognition for secure access, mood-responsive lighting, RFID-enabled garage entry, and clap-activated door closures. This system elevates the living experience by seamlessly blending security, convenience, and ambiance-enhancingÂ technology.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">spidevpp - C++ wrapper for spidev </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>spidevpp provides a simple wrapper to easily use spidev from C++ applications. Many Raspberry Pi projects use the <a href="http://www.airspayce.com/mikem/bcm2835/">bcm2835 library</a> to access the SPI interface. The downside is that it requires root privileges to access /dev/mem and is therefire not suitable for many applications. Using spidev to access the SPI interface is a promising alternative that allows access to non-root users based on udev rules.</p>
<p>The library provides the spidev interface and a GPIO interface (without any dependencies like wiringPi etc.) to drive additional CS lines, reset lines or any other output that needs to be set for an SPI slave device to work properly.</p>
<p>The project can be pulled in as a submodule and integrates with cmake (Check <a href="https://github.com/twyleg/mfrc522-cpp">mfrc522-cpp</a> for an example). It was successfully tested on a Raspberry Pi 3B+ with Raspbian GNU/Linux 10 (buster) but should be compatible with every linux that provides spidev kernel support.</p>
<h1><a class="anchor" id="autotoc_md33"></a>
Prerequisites</h1>
<p>To make SPI and GPIO accessible to non-root users, make sure that you have udev rules like the following in place: </p><pre class="fragment">SUBSYSTEM=="spidev", GROUP="spi", MODE="0660"
SUBSYSTEM=="bcm2835-gpiomem", GROUP="gpio", MODE="0660"
</pre><p> On Raspbian/Raspberry Pi OS this should already be included in **/dev/udev/rules.d/99-com.rules** and will cause the spidev and GPIO devices to be assigned to the spi/gpio groups with read/write access.</p>
<p>Make sure that your user is a member of the groups <b>spi</b> and <b>gpio</b> or create the groups and add the user witht he following commands: </p><pre class="fragment">sudo groupadd spi
sudo groupadd gpio
sudo adduser opendashboard spi
sudo adduser opendashboard gpio
</pre> <h1><a class="anchor" id="autotoc_md34"></a>
Building</h1>
<p>Clone the repo: </p><pre class="fragment">git clone https://github.com/twyleg/spidevpp
</pre><p> Create a build directory: </p><pre class="fragment">cd spidev
mkdir build
</pre><p> Run cmake: </p><pre class="fragment">cd build
cmake ..
</pre><p> Build: </p><pre class="fragment">make
</pre> <h1><a class="anchor" id="autotoc_md35"></a>
Example application for smoke testing</h1>
<p>The project provides a loopback example for smoke testing that expects the MISO and MOSI pin to be connected. This way the write and read functionality can be tested without an additional slave device by simply writting some data and receiving the data at the same time. </p><pre class="fragment">cd spidevpp/build/apps/loopback_example_app
./loopback_example_app /dev/spidev0.0
</pre><p> This should create the following result: </p><pre class="fragment">read check PASSED
write check PASSED
readWrite check PASSED
</pre> <h1><a class="anchor" id="autotoc_md36"></a>
Troubleshooting</h1>
<h2><a class="anchor" id="autotoc_md37"></a>
Conflict between bcm2835 and spidev on RPi</h2>
<p>Be aware that running an application that uses the bcm2835 spi implementation can cause spidev to malfunction. The reason seem to be that bcm2835 keeps ownership of the CS pins which makes it impossible for the spidev driver to drive the CS lines and enable the slave devices. A quick and dirty fix is to restart the RPi or to simply reload the following kernel modules: </p><pre class="fragment">sudo rmmod spi_bcm2835
sudo modprobe spi_bcm2835
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
